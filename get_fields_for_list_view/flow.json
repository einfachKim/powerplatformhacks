//Main flow -> copy json below
{"id":"068929a8-31d4-470f-96d8-27035c54c7c4","brandColor":"#8C3900","connectionReferences":{"shared_office365_1":{"connection":{"id":"/ema_OutlookConnectionReferenceSharePointViewer"}},"shared_sharepointonline_3":{"connection":{"id":"/ema_sharedsharepointonline_0e48a"}}},"connectorDisplayName":"Steuerelement","icon":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KIDxwYXRoIGQ9Im0wIDBoMzJ2MzJoLTMyeiIgZmlsbD0iIzhDMzkwMCIvPg0KIDxwYXRoIGQ9Im04IDEwaDE2djEyaC0xNnptMTUgMTF2LTEwaC0xNHYxMHptLTItOHY2aC0xMHYtNnptLTEgNXYtNGgtOHY0eiIgZmlsbD0iI2ZmZiIvPg0KPC9zdmc+DQo=","isTrigger":false,"operationName":"Main","operationDefinition":{"type":"Scope","actions":{"Send_an_HTTP_request_to_SharePoint_|_Get_All_Views":{"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_sharepointonline_3","operationId":"HttpRequest","apiId":"/providers/Microsoft.PowerApps/apis/shared_sharepointonline"},"parameters":{"dataset":"@triggerBody()['text']","parameters/method":"GET","parameters/uri":"_api/@{triggerBody()['text_1']}","parameters/headers":{"Accept":"application/json; odata=verbose","Content-Type":"application/json"},"parameters/body":"\n"},"authentication":"@parameters('$authentication')"},"runAfter":{},"description":"based on the site and the ViewFieldUri, generated in 3.0 | SharePoint Viewer | Load SharePoint List Views | Instant the fields of the selected view get retrieved","metadata":{"operationMetadataId":"bd6754b2-3869-4bf7-a554-ad23503a9c7f"}},"Select":{"type":"Select","inputs":{"from":"@body('Send_an_HTTP_request_to_SharePoint_|_Get_All_Views')['d']?['Items']?['results']","select":{"Field":"@item()"}},"runAfter":{"Send_an_HTTP_request_to_SharePoint_|_Get_All_Views":["Succeeded"]},"description":"The one dimensional array gets selected and the key \"Field\" is added","metadata":{"operationMetadataId":"41d8ec7a-de3d-487a-a2b3-3e27a5a38b80"}},"Auf_eine_PowerApp_oder_einen_Flow_antworten":{"type":"Response","kind":"PowerApp","inputs":{"statusCode":200,"body":{"response":"@{string(body('Select'))}","status":"The flow ran sucessfully!"},"schema":{"type":"object","properties":{"response":{"title":"response","x-ms-dynamically-added":true,"type":"string"},"status":{"title":"status","x-ms-dynamically-added":true,"type":"string"}}}},"runAfter":{"Select":["Succeeded"]},"description":"array of fields (response) and notification (status) get send to the powerapp","metadata":{"operationMetadataId":"7e29703d-ac8f-4d3b-abcc-3bb97fa35f1c"}}},"runAfter":{},"metadata":{"operationMetadataId":"d8377724-a4ae-48cc-9327-ea4772e20f10"}}}

//Exception handler -> copy json below
{"id":"0266d335-2bdc-4c86-bbca-a99745d5801c","brandColor":"#8C3900","connectionReferences":{"shared_office365_1":{"connection":{"id":"/ema_OutlookConnectionReferenceSharePointViewer"}},"shared_sharepointonline_3":{"connection":{"id":"/ema_sharedsharepointonline_0e48a"}}},"connectorDisplayName":"Steuerelement","icon":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KIDxwYXRoIGQ9Im0wIDBoMzJ2MzJoLTMyeiIgZmlsbD0iIzhDMzkwMCIvPg0KIDxwYXRoIGQ9Im04IDEwaDE2djEyaC0xNnptMTUgMTF2LTEwaC0xNHYxMHptLTItOHY2aC0xMHYtNnptLTEgNXYtNGgtOHY0eiIgZmlsbD0iI2ZmZiIvPg0KPC9zdmc+DQo=","isTrigger":false,"operationName":"Exception_handler","operationDefinition":{"type":"Scope","actions":{"Send_an_email_(V2)_|_Send_mail_to_exception_receiver":{"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_office365_1","operationId":"SendEmailV2","apiId":"/providers/Microsoft.PowerApps/apis/shared_office365"},"parameters":{"emailMessage/To":"@outputs('Compose_|_Exception_receiver')","emailMessage/Subject":"Error with a flow: @{workflow()['tags']['flowDisplayName']}","emailMessage/Body":"<p>Error with the flow. See the table below.<br>\n<br>\n<strong>Technical Name:</strong> @{workflow()['Name']}<br>\n<strong>Display Name:</strong> @{workflow()['tags']['flowDisplayName']}<br>\n<strong>Environment Name: </strong>@{workflow()['tags']['environmentName']}<br>\n<br>\n<strong>Link to flow run: </strong>@{concat('https://make.powerautomate.com/manage/environments/', workflow()?['tags']?['environmentName'], '/flows/', workflow()?['name'], '/runs/', workflow()?['run']['name'])}<br>\n<strong>Link to the flow:</strong> @{concat('https://make.powerautomate.com/manage/environments/', workflow()?['tags']?['environmentName'], '/flows/', workflow()?['name'])}<br>\n<br>\n@{body('Create_HTML_table_|_Create_table_with_errors')}</p>","emailMessage/Importance":"Normal"},"authentication":"@parameters('$authentication')"},"runAfter":{"Create_HTML_table_|_Create_table_with_errors":["Succeeded"]},"metadata":{"operationMetadataId":"4b1db751-6212-42a0-ac89-77d6a5ac3a3f"}},"Terminate":{"metadata":{"operationMetadataId":"08fc212b-4ecf-43e6-a829-b6f9d31661aa"},"type":"Terminate","inputs":{"runStatus":"Failed"},"runAfter":{"Send_an_email_(V2)_|_Send_mail_to_exception_receiver":["Succeeded"]}},"Create_HTML_table_|_Create_table_with_errors":{"type":"Table","inputs":{"from":"@result('Main')","format":"HTML","columns":[{"header":"name","value":"@item()?['name']"},{"header":"code","value":"@item()?['code']"},{"header":"status","value":"@item()?['status']"},{"header":"code","value":"@item()?['error']?['code']"},{"header":"message","value":"@item()?['error']?['message']"}]},"runAfter":{"Compose_|_Exception_receiver":["Succeeded"]},"metadata":{"operationMetadataId":"ab172923-2ad3-4b5e-aac4-59086c8a3fb1"}},"Respond_to_a_PowerApp_or_flow_|_Respond_Error":{"type":"Response","kind":"PowerApp","inputs":{"statusCode":200,"body":{"response":"@{null}","status":"There was a problem in the flow. You have received an email with further information."},"schema":{"type":"object","properties":{"response":{"title":"response","x-ms-dynamically-added":true,"type":"string"},"status":{"title":"status","x-ms-dynamically-added":true,"type":"string"}}}},"runAfter":{},"metadata":{"operationMetadataId":"b5ab2e68-1842-441c-80df-f41f27e4999d"}},"Compose_|_Exception_receiver":{"type":"Compose","inputs":"@triggerOutputs()['headers']['x-ms-user-email-encoded']","runAfter":{"Respond_to_a_PowerApp_or_flow_|_Respond_Error":["Succeeded"]},"metadata":{"operationMetadataId":"6ef64c46-bdb5-4b98-9eac-2b52877e5170"}}},"runAfter":{"Main":["Failed"]},"description":"this scope handles exceptions / errors from the upper scope. if within upper scope any error occurs, this scope runs, sends message to the powerapps and via mail to the person who triggered the flow","metadata":{"operationMetadataId":"7778dea0-b063-4bf8-b510-0a3a638c2d4d"}}}
