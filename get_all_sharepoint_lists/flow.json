//Main Flow -> Copy only the JSON below
{"id":"2f95a401-ecdb-45c0-8dae-cc5fef6fe10b","brandColor":"#8C3900","connectionReferences":{"shared_office365_1":{"connection":{"id":"/ema_OutlookConnectionReferenceSharePointViewer"}},"shared_sharepointonline_1":{"connection":{"id":"/new_SharePointConnectionReference"}}},"connectorDisplayName":"Control","icon":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KIDxwYXRoIGQ9Im0wIDBoMzJ2MzJoLTMyeiIgZmlsbD0iIzhDMzkwMCIvPg0KIDxwYXRoIGQ9Im04IDEwaDE2djEyaC0xNnptMTUgMTF2LTEwaC0xNHYxMHptLTItOHY2aC0xMHYtNnptLTEgNXYtNGgtOHY0eiIgZmlsbD0iI2ZmZiIvPg0KPC9zdmc+DQo=","isTrigger":false,"operationName":"Main","operationDefinition":{"type":"Scope","actions":{"Send_an_HTTP_request_to_SharePoint":{"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_sharepointonline_1","operationId":"HttpRequest","apiId":"/providers/Microsoft.PowerApps/apis/shared_sharepointonline"},"parameters":{"dataset":"@triggerBody()['text']","parameters/method":"GET","parameters/uri":"_api/web/lists","parameters/headers":{"Accept":"application/json;odata=verbose"}},"authentication":"@parameters('$authentication')"},"runAfter":{},"description":"based on the sharepoint site selected in the powerapp all lists get retrieved, using the \"lists\" endpoint.","metadata":{"operationMetadataId":"d5df6d11-1ad7-43de-a66f-9cd2f0fc55e3"}},"Filter_array":{"type":"Query","inputs":{"from":"@body('Send_an_HTTP_request_to_SharePoint')?['d']?['results']","where":"@equals(item()?['hidden'], false)"},"runAfter":{"Send_an_HTTP_request_to_SharePoint":["Succeeded"]},"description":"we do not want to retrieve hidden lists. @and(equals(iteM()?['hidden'], false)","metadata":{"operationMetadataId":"58e69f02-7061-4b5e-aca5-c85c04d21143"}},"Select":{"type":"Select","inputs":{"from":"@body('Filter_array')","select":{"Title":"@item()?['title']","ItemCount":"@item()?['ItemCount']","Id":"@item()['Id']","Created":"@item()['Created']"}},"runAfter":{"Filter_array":["Succeeded"]},"description":"the title as well as the ItemCount (how many items are in this list) get retrieved","metadata":{"operationMetadataId":"8785a12e-dd99-434f-adf4-32e74ab16fea"}},"Respond_to_a_PowerApp_or_flow":{"type":"Response","kind":"PowerApp","inputs":{"statusCode":200,"body":{"response":"@{body('Select')}","status":"The flow ran successfully!"},"schema":{"type":"object","properties":{"response":{"title":"response","x-ms-dynamically-added":true,"type":"string"},"status":{"title":"status","x-ms-dynamically-added":true,"type":"string"}}}},"runAfter":{"Select":["Succeeded"]},"description":"response (array of sharepoint lists) as json string and a status get send to the power apps","metadata":{"operationMetadataId":"16bd2a34-be92-45f7-9b60-673f6528eeb0"}}},"runAfter":{},"metadata":{"operationMetadataId":"8e1caf5f-3df6-47d3-a603-77015145f864"}}}

//Exception Handler -> Copy only the JSON below
{"id":"de744fe8-c603-4ead-9d81-f401b0240660","brandColor":"#8C3900","connectionReferences":{"shared_office365_1":{"connection":{"id":"/ema_OutlookConnectionReferenceSharePointViewer"}},"shared_sharepointonline_1":{"connection":{"id":"/new_SharePointConnectionReference"}}},"connectorDisplayName":"Control","icon":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KIDxwYXRoIGQ9Im0wIDBoMzJ2MzJoLTMyeiIgZmlsbD0iIzhDMzkwMCIvPg0KIDxwYXRoIGQ9Im04IDEwaDE2djEyaC0xNnptMTUgMTF2LTEwaC0xNHYxMHptLTItOHY2aC0xMHYtNnptLTEgNXYtNGgtOHY0eiIgZmlsbD0iI2ZmZiIvPg0KPC9zdmc+DQo=","isTrigger":false,"operationName":"Exception_handler","operationDefinition":{"type":"Scope","actions":{"Send_an_email_(V2)_|_Send_mail_to_exception_receiver":{"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_office365_1","operationId":"SendEmailV2","apiId":"/providers/Microsoft.PowerApps/apis/shared_office365"},"parameters":{"emailMessage/To":"@outputs('Compose_|_Exception_receiver')","emailMessage/Subject":"Error with a flow: @{workflow()['tags']['flowDisplayName']}","emailMessage/Body":"<p>Error with the flow. See the table below.<br>\n<br>\n<strong>Technical Name:</strong> @{workflow()['Name']}<br>\n<strong>Display Name:</strong> @{workflow()['tags']['flowDisplayName']}<br>\n<strong>Environment Name: </strong>@{workflow()['tags']['environmentName']}<br>\n<br>\n<strong>Link to flow run: </strong>@{concat('https://make.powerautomate.com/manage/environments/', workflow()?['tags']?['environmentName'], '/flows/', workflow()?['name'], '/runs/', workflow()?['run']['name'])}<br>\n<strong>Link to the flow:</strong> @{concat('https://make.powerautomate.com/manage/environments/', workflow()?['tags']?['environmentName'], '/flows/', workflow()?['name'])}<br>\n<br>\n@{body('Create_HTML_table_|_Create_table_with_errors')}</p>","emailMessage/Importance":"Normal"},"authentication":"@parameters('$authentication')"},"runAfter":{"Create_HTML_table_|_Create_table_with_errors":["Succeeded"]},"metadata":{"operationMetadataId":"4b1db751-6212-42a0-ac89-77d6a5ac3a3f"}},"Terminate":{"metadata":{"operationMetadataId":"08fc212b-4ecf-43e6-a829-b6f9d31661aa"},"type":"Terminate","inputs":{"runStatus":"Failed"},"runAfter":{"Send_an_email_(V2)_|_Send_mail_to_exception_receiver":["Succeeded"]}},"Create_HTML_table_|_Create_table_with_errors":{"type":"Table","inputs":{"from":"@result('Main')","format":"HTML","columns":[{"header":"name","value":"@item()?['name']"},{"header":"code","value":"@item()?['code']"},{"header":"status","value":"@item()?['status']"},{"header":"code","value":"@item()?['error']?['code']"},{"header":"message","value":"@item()?['error']?['message']"}]},"runAfter":{"Compose_|_Exception_receiver":["Succeeded"]},"metadata":{"operationMetadataId":"ab172923-2ad3-4b5e-aac4-59086c8a3fb1"}},"Respond_to_a_PowerApp_or_flow_|_Respond_Error":{"type":"Response","kind":"PowerApp","inputs":{"statusCode":200,"body":{"response":"@{null}","status":"There was a problem in the flow. You have received an email with further information."},"schema":{"type":"object","properties":{"response":{"title":"response","x-ms-dynamically-added":true,"type":"string"},"status":{"title":"status","x-ms-dynamically-added":true,"type":"string"}}}},"runAfter":{},"metadata":{"operationMetadataId":"b5ab2e68-1842-441c-80df-f41f27e4999d"}},"Compose_|_Exception_receiver":{"type":"Compose","inputs":"@triggerOutputs()['headers']['x-ms-user-email-encoded']","runAfter":{"Respond_to_a_PowerApp_or_flow_|_Respond_Error":["Succeeded"]},"metadata":{"operationMetadataId":"6ef64c46-bdb5-4b98-9eac-2b52877e5170"}}},"runAfter":{"Main":["Failed"]},"description":"this scope handles exceptions / errors from the upper scope. if within upper scope any error occurs, this scope runs, sends message to the powerapps and via mail to the person who triggered the flow","metadata":{"operationMetadataId":"7778dea0-b063-4bf8-b510-0a3a638c2d4d"}}}
