// Main Flow -> Copy json below
{"id":"c2af734d-8ee3-4576-b592-f760b1558b86","brandColor":"#8C3900","connectionReferences":{"shared_sharepointonline":{"connection":{"id":"/ema_SharePointConnectionReference"}},"shared_office365_1":{"connection":{"id":"/ema_OutlookConnectionReferenceSharePointViewer"}}},"connectorDisplayName":"Control","icon":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KIDxwYXRoIGQ9Im0wIDBoMzJ2MzJoLTMyeiIgZmlsbD0iIzhDMzkwMCIvPg0KIDxwYXRoIGQ9Im04IDEwaDE2djEyaC0xNnptMTUgMTF2LTEwaC0xNHYxMHptLTItOHY2aC0xMHYtNnptLTEgNXYtNGgtOHY0eiIgZmlsbD0iI2ZmZiIvPg0KPC9zdmc+DQo=","isTrigger":false,"operationName":"Main","operationDefinition":{"type":"Scope","actions":{"Send_an_HTTP_request_to_SharePoint":{"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_sharepointonline","operationId":"HttpRequest","apiId":"/providers/Microsoft.PowerApps/apis/shared_sharepointonline"},"parameters":{"dataset":"@triggerBody()['text']","parameters/method":"POST","parameters/uri":"_api/web/lists/getbyid('@{triggerBody()['text_1']}')/Views('@{triggerBody()['text_2']}')","parameters/headers":{"Accept":"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","X-HTTP-Method":"MERGE"},"parameters/body":"{ \"__metadata\": \n{ \"type\": \"SP.View\" }, \n\"ViewQuery\": \"<OrderBy><FieldRef Name=\\\"ID\\\" /></OrderBy><Where><Eq><FieldRef Name=\\\"ID\\\" /><Value Type=\\\"Counter\\\">0</Value></Eq></Where>\"\n}\n"},"authentication":"@parameters('$authentication')"},"runAfter":{},"description":"a selected view gets cutomized, by applying a filter on ID = 0","metadata":{"operationMetadataId":"96f8e4cd-3a4b-485d-8027-515a6fb2eb3c"}},"Respond_to_a_PowerApp_or_flow":{"type":"Response","kind":"PowerApp","inputs":{"statusCode":200,"body":{"status":"The flow ran sucessfully!"},"schema":{"type":"object","properties":{"status":{"title":"status","x-ms-dynamically-added":true,"type":"string"}}}},"runAfter":{"Send_an_HTTP_request_to_SharePoint":["Succeeded"]},"description":"status notification is sent to the app","metadata":{"operationMetadataId":"b5ab2e68-1842-441c-80df-f41f27e4999d"}}},"runAfter":{},"metadata":{"operationMetadataId":"f5a0bb9f-2bca-42b1-b14c-7d1cd376bfb9"}}}

// Exception handler -> Copy json below
{"id":"365d8184-ca60-4568-bd8f-b7bbdabadc18","brandColor":"#8C3900","connectionReferences":{"shared_sharepointonline":{"connection":{"id":"/ema_SharePointConnectionReference"}},"shared_office365_1":{"connection":{"id":"/ema_OutlookConnectionReferenceSharePointViewer"}}},"connectorDisplayName":"Control","icon":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KIDxwYXRoIGQ9Im0wIDBoMzJ2MzJoLTMyeiIgZmlsbD0iIzhDMzkwMCIvPg0KIDxwYXRoIGQ9Im04IDEwaDE2djEyaC0xNnptMTUgMTF2LTEwaC0xNHYxMHptLTItOHY2aC0xMHYtNnptLTEgNXYtNGgtOHY0eiIgZmlsbD0iI2ZmZiIvPg0KPC9zdmc+DQo=","isTrigger":false,"operationName":"Exception_handler","operationDefinition":{"type":"Scope","actions":{"Send_an_email_(V2)_|_Send_mail_to_exception_receiver":{"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_office365_1","operationId":"SendEmailV2","apiId":"/providers/Microsoft.PowerApps/apis/shared_office365"},"parameters":{"emailMessage/To":"@outputs('Compose_|_Exception_receiver')","emailMessage/Subject":"Error with a flow: @{workflow()['tags']['flowDisplayName']}","emailMessage/Body":"<p>Error with the flow. See the table below.<br>\n<br>\n<strong>Technical Name:</strong> @{workflow()['Name']}<br>\n<strong>Display Name:</strong> @{workflow()['tags']['flowDisplayName']}<br>\n<strong>Environment Name: </strong>@{workflow()['tags']['environmentName']}<br>\n<br>\n<strong>Link to flow run: </strong>@{concat('https://make.powerautomate.com/manage/environments/', workflow()?['tags']?['environmentName'], '/flows/', workflow()?['name'], '/runs/', workflow()?['run']['name'])}<br>\n<strong>Link to the flow:</strong> @{concat('https://make.powerautomate.com/manage/environments/', workflow()?['tags']?['environmentName'], '/flows/', workflow()?['name'])}<br>\n<br>\n@{body('Create_HTML_table_|_Create_table_with_errors')}</p>","emailMessage/Importance":"Normal"},"authentication":"@parameters('$authentication')"},"runAfter":{"Create_HTML_table_|_Create_table_with_errors":["Succeeded"]},"metadata":{"operationMetadataId":"4b1db751-6212-42a0-ac89-77d6a5ac3a3f"}},"Terminate":{"metadata":{"operationMetadataId":"08fc212b-4ecf-43e6-a829-b6f9d31661aa"},"type":"Terminate","inputs":{"runStatus":"Failed"},"runAfter":{"Send_an_email_(V2)_|_Send_mail_to_exception_receiver":["Succeeded"]}},"Create_HTML_table_|_Create_table_with_errors":{"type":"Table","inputs":{"from":"@result('Main')","format":"HTML","columns":[{"header":"name","value":"@item()?['name']"},{"header":"code","value":"@item()?['code']"},{"header":"status","value":"@item()?['status']"},{"header":"code","value":"@item()?['error']?['code']"},{"header":"message","value":"@item()?['error']?['message']"}]},"runAfter":{"Compose_|_Exception_receiver":["Succeeded"]},"metadata":{"operationMetadataId":"ab172923-2ad3-4b5e-aac4-59086c8a3fb1"}},"Respond_to_a_PowerApp_or_flow_|_Respond_Error":{"type":"Response","kind":"PowerApp","inputs":{"statusCode":200,"body":{"status":"There was a problem in the flow. You have received an email with further information."},"schema":{"type":"object","properties":{"status":{"title":"status","x-ms-dynamically-added":true,"type":"string"}}}},"runAfter":{},"metadata":{"operationMetadataId":"b5ab2e68-1842-441c-80df-f41f27e4999d"}},"Compose_|_Exception_receiver":{"type":"Compose","inputs":"@triggerOutputs()['headers']['x-ms-user-email-encoded']","runAfter":{"Respond_to_a_PowerApp_or_flow_|_Respond_Error":["Succeeded"]},"metadata":{"operationMetadataId":"6ef64c46-bdb5-4b98-9eac-2b52877e5170"}}},"runAfter":{"Main":["Failed"]},"description":"this scope handles exceptions / errors from the upper scope. if within upper scope any error occurs, this scope runs, sends message to the powerapps and via mail to the person who triggered the flow","metadata":{"operationMetadataId":"7778dea0-b063-4bf8-b510-0a3a638c2d4d"}}}
